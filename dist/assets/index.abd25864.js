var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,i=(e,t)=>{for(var s in t||(t={}))o.call(t,s)&&a(e,s,t[s]);if(r)for(var s of r(t))n.call(t,s)&&a(e,s,t[s]);return e},c=(e,r)=>t(e,s(r)),u=("undefined"!=typeof require&&require,(e,t)=>{var s={};for(var a in e)o.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&r)for(var a of r(e))t.indexOf(a)<0&&n.call(e,a)&&(s[a]=e[a]);return s});import{r as l,d,a as f,c as p,b as m,w as h,o as g,e as y,f as v,u as I,g as b,h as P,m as q,n as w,i as E,j as O,k as S,l as _,v as k,p as L,q as R,s as j,t as N,x,y as C,S as A,z as T,M as $,A as U,T as K,B as D,C as z,D as M,E as V,F as J,R as B,G as F,H as G,I as H,J as Q,K as W,L as X,N as Y,O as Z,P as ee,U as te,Q as se,V as re,W as oe,X as ne,Y as ae,Z as ie,_ as ce,$ as ue}from"./vendor.2520681f.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();function le(e,t={}){const{isInput:s}=t,r=l(e);return[r,function(e){let t=e;s&&"object"==typeof e&&(t=e.target.value),r.value=t}]}const de={class:"base-upload-comp"},fe={class:"btn"};var pe=d({__name:"index",props:{accept:{type:String,require:!0,default:""},multiple:{type:Boolean,default:!0},moduleKey:{type:String,default:""}},emits:["beforeUpload","customRequest"],setup(e,{emit:t}){function s(){console.log("beforeUpload"),t("beforeUpload")}function r(e={}){console.log("upload",e),t("customRequest",e.file)}return(t,o)=>{const n=f("a-upload");return g(),p("div",de,[m(n,{class:"a-upload",multiple:e.multiple,"with-credentials":!0,"show-upload-list":!1,directory:!1,accept:e.accept,"before-upload":s,"custom-request":r},{default:h((()=>[y("div",fe,[v(t.$slots,"default")])])),_:3},8,["multiple","accept"])])}}});class me{constructor(){var e,t;a(this,"symbol"!=typeof(e="events")?e+"":e,t),this.events={}}addEventLister(e,t){return this.events[e]=this.events[e]||[],this.events[e].push(t),()=>{this.clearEvents(e,t)}}execEvent(e,t){(this.events[e]||[]).forEach((e=>{e&&"function"==typeof e&&e(t)}))}clear(){this.events={}}clearEvents(e,t){if(t){const s=this.events[e];for(let e=0;e<s.length;e+=1)if(s[e]===t){s.splice(e,1);break}}else this.events[e]=[]}}const he=new Proxy({},{get:(e,t)=>(e[t]||(e[t]=new me),e[t])});const ge={class:"pdf-upload-comp"};var ye=d({__name:"index",props:{uploadState:{type:String,default:""}},setup(e,{expose:t}){const[s,r]=le(""),o=I(),n=b();he.chat.addEventLister("upload",l);const a=P((()=>o.state.intervalArr));async function i(e=""){console.log("zj--file",e),""!=e&&(console.log("zj--fileName=",e.name,o),o.commit("setFileName",e.name)),console.log("customRequest"),l(e)}function c(){he.chat.execEvent("clearHightlight");let e=document.getElementsByClassName("chunks");console.log("chunksEles",e);for(let t=0;t<e.length;t++)console.log("chunksEles[i]",e[t]),e[t].innerHTML="";console.log("over-----"),function(){const e=a.value;for(let t=0;t<e.length;t++)clearInterval(e[t]);o.commit("setIntervalArr",[])}(),r(""),o.commit("setPercent",0),o.commit("setPdfInfo",{}),o.commit("setSummaryData",[]),o.commit("setPageSize",[]),o.commit("setPagesInfo",[]),o.commit("setIsSummaryInit",!1)}let u;async function l(e){c(),o.commit("setIsShowProgress",!0);let t=0;u=setInterval((()=>{console.log("zj--percent",t),o.commit("setPercent",t),t<90&&(t+=Math.floor(5*Math.random()))}),400),function(e){let t=a.value;t.push(e),o.commit("setIntervalArr",[...t])}(u);let i={pdfSrc:URL.createObjectURL(e)};if(e){const t=new FormData;t.append("file",e),t.append("do_summarize","true"),t.append("do_prepare_for","false"),t.append("do_prepare_for_QA","false");fetch(""+"/upload",{method:"POST",body:t}).then((e=>{if(console.log(e),e.ok)return e.json();throw new Error("上传失败")})).then((e=>{if(console.log(e),e.doc_id){let t=e.doc_id;r(t);const o={docId:s.value};n.replace({path:"/pdfView",query:o})}})).catch((e=>{console.log(e),q.error(JSON.stringify(e.message)||"出错了")})),o.commit("setPdfInfo",JSON.parse(JSON.stringify(i)))}}return t({customRequest:i,upload:l,uploadByUrl:async function(e,t){c(),o.commit("setIsShowProgress",!0);let s={pdfSrc:e};o.commit("setPdfInfo",JSON.parse(JSON.stringify(s))),n.push({path:"/pdfView",query:{docId:t}})}}),(t,s)=>{const r=f("a-button");return g(),p("div",ge,[m(pe,{accept:".pdf",onCustomRequest:i},{default:h((()=>[m(r,{class:w("home"===e.uploadState?"upload-btn-home":"upload-btn"),type:"primary"},{default:h((()=>[E(" 上传文件 ")])),_:1},8,["class"])])),_:1})])}}});const ve={class:"header-comp"},Ie={class:"top"},be=y("div",{class:"logo"},[y("img",{src:"./assets/youdao_icon.75fdff8c.png"})],-1),Pe={class:"head-upload-tooltip"};var qe=d({__name:"index",setup(e){const t=I(),s=b(),[r,o]=le(!1),n=P((()=>t.state.intervalArr));return O((()=>s.currentRoute.value),(()=>{"pdfView"!==s.currentRoute.value.name&&function(){console.log("clearAllInterval",s.currentRoute.value);const e=n.value;for(let t=0;t<e.length;t++)clearInterval(e[t]);t.commit("setIntervalArr",[])}()})),(e,t)=>(g(),p("div",ve,[y("div",Ie,[be,m(ye,{onMouseover:t[0]||(t[0]=()=>S(o)(!0)),onMouseout:t[1]||(t[1]=()=>S(o)(!1))})]),_(y("div",Pe," 当前仅支持上传pdf格式，建议上传文件大小不超过20M，页数不超过100页。 ",512),[[k,S(r)]])]))}});function we(){const e=b();return{isReady:function(t=(()=>{}),s=(()=>{})){e.isReady().then(t,s)},getCurrentRoute:function(){return e.currentRoute},getUrlParams:function(t){const{query:s={},params:r={}}=e.currentRoute.value;return t?s[t]||r[t]:i(i({},s),r)},changePage:function(t,s={}){const r=s,{refreshCurrent:o}=r,n=u(r,["refreshCurrent"]);o&&e.currentRoute.value.path===t?window.location.reload():e.push({path:t,query:n})},pageBack:function(t){t&&setTimeout((()=>{he.back.execEvent("back",t)}),300),e.back()},beforeEach:function(t){e.beforeEach(((...e)=>{t(...e)}))},openNewPage:function(t,s={}){const r=e.resolve({path:t,query:s});window.open(r.href,"_blank")},openTargetNewPage:function(e){window.open(e,"_blank")},replace:function(t,s={}){console.log("zxx--re--",t,e),e.replace({path:t,query:s})}}}const Ee={class:"page-app"};var Oe=d({__name:"App",setup(e){const{beforeEach:t}=we(),[s,r]=le(!0);return t(((e,t,s)=>{!1===e.meta.showNavSider?r(!1):r(!0),s()})),(e,t)=>{const r=f("router-view");return g(),p("div",Ee,[S(s)?(g(),L(qe,{key:0})):R("v-if",!0),m(r)])}}});const Se={},_e=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`./${e}`)in Se)return;Se[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script",r.crossOrigin=""),r.href=e,document.head.appendChild(r),t?new Promise(((e,t)=>{r.addEventListener("load",e),r.addEventListener("error",t)})):void 0}))).then((()=>e())):e()},ke=[{path:"/",redirect:"/home"},{path:"/home",name:"home",component:()=>_e((()=>import("./index.b31491a8.js")),["assets/index.b31491a8.js","assets/index.b090f5c0.css","assets/vendor.2520681f.js","assets/config.d7ae1ecb.js"])},{path:"/pdfView",name:"pdfView",component:()=>_e((()=>import("./index.d5a777a8.js")),["assets/index.d5a777a8.js","assets/index.e67d2664.css","assets/vendor.2520681f.js","assets/config.d7ae1ecb.js"])},{path:"/noPermission",name:"noPermission",component:()=>_e((()=>import("./index.9591f4ef.js")),["assets/index.9591f4ef.js","assets/index.fc6e6d16.css","assets/vendor.2520681f.js"]),meta:{}},{path:"/:catchAll(.*)",redirect:"/home"}],Le=j({history:N(),routes:ke});Le.beforeEach(((e,t,s)=>{s()}));var Re={response:function(e){return e},responseError:function(e={},t){const{config:s}=e,{url:r,retryCount:o=3,curRetry:n=0,retryDelay:a}=s;if(s.curRetry||(s.curRetry=0),o>n){s.curRetry+=1;return new Promise((e=>{setTimeout((()=>{e()}),a)})).then((()=>(console.log(`重试:${r},第${s.curRetry}次`),t(s))))}return Promise.reject(e)}};const je={axios:null,requests:{},clear(e){e?delete this.requests[e]:this.requests={}},setAxios(e){this.axios||(this.axios=e)},has(e){const t=this.getKey(e);return e.requestKey=t,!!this.requests[e.requestKey]},getKey:e=>`${e.url}/${JSON.stringify(e.params)}/${JSON.stringify(e.data)}&request_type=${e.method}`,remove(e){if(!Object.keys(this.requests).length)return;const t=e.requestKey;this.requests[t]&&(this.requests[t](),this.clear(t))},cancel(e,t){const{CancelToken:s}=x;e.cancelToken=new s(t)},add(e){const t=je.getKey(e);e.requestKey=t}};var Ne={pending:je,request:function(e){return je.has(e)||je.add(e),e},response:function(e){return je.remove(e.config),e}};const xe={noPerssion:{code:403},noLogin:{code:401},isSuccess:{code:200}},Ce={};Object.keys(xe).forEach((e=>{Ce[e]=(t="")=>Number(t)===xe[e].code}));const Ae={requests:{},getKey:e=>`${e.url.split("?")[0]}/&request_type=${e.method}`,clear(){this.requests={}},add(e){const t=this.getKey(e);this.requests[t]=e},getConfig(e){const t=this.getKey(e),s=this.requests[t];return this.remove(t),s},remove(e){delete this.requests[e]},has(e){const t=this.getKey(e);return!!this.requests[t]}};const Te={ids:{},addLoading(e){e.hideLoading=q.loading({content:"loading",duration:0})},addId(e){const{loadingId:t,hideLoading:s}=e;this.ids[t]?(this.ids[t].loadingNum+=1,e.hideLoading=this.ids[t].hideLoading):this.ids[t]={loadingNum:1,hideLoading:s}},canShow(e){return!this.ids[e]||0===this.ids[e].loadingNum},removeId(e){this.ids[e]&&(this.ids[e].loadingNum-=1,0===this.ids[e].loadingNum&&delete this.ids[e])}};function $e(e){const{config:t={}}=e||{},{hideLoading:s,loadingId:r}=t;return s&&(r?(Te.removeId(r),Te.canShow(r)&&s()):s()),e}var Ue={autoRetry:Re,cancelRepeat:Ne,errorToast:{response:function(e){const{config:t={}}=e||{};return!Ce.isSuccess(e.data.code)&&t.errorToast,e},responseError:function(e){return q.error("请求失败，请重试"),Promise.reject(e)}},forceRetry:{forceHandle:Ae,request:function(e){if(Ae.has(e)){const t=Ae.getConfig(e);e=c(i({},e),{url:t.urla,params:t.url,data:t.url})}return e},response:function(e){return e},responseError:function(e={}){return Ae.add(e.config),Promise.reject(e)}},showLoading:{request:function(e){const{loadingId:t}=e;return t?(Te.canShow(t)&&Te.addLoading(e),Te.addId(e)):Te.addLoading(e),e},response:$e,responseError:function(e){return Promise.reject($e(e))}}};x.defaults.withCredentials=!0;const Ke=["errorToast","rdLoginReqToken"];function De(e,t,s,r){const{config:o={}}=e||{};return Ke.indexOf(t)>-1||s.response&&o[t]?s.response(e,r):e}const ze=x.create({headers:{}});function Me(e){return e>=200&&e<300}!function(e){if(!e)return;const t=i({},Ue);Object.keys(t).forEach((s=>{const r=t[s];(r.request||r.requestError)&&e.interceptors.request.use((t=>Ke.indexOf(s)>-1||r.request&&function(e,t){return e[t]}(t,s)?r.request(t,e):t),(e=>r.requestError?r.requestError(e):Promise.reject(e))),(r.response||r.responseError)&&e.interceptors.response.use((t=>De(t,s,r,e)),(t=>{const{config:o={},headers:n={}}=t,a={config:o,statusText:"OK",headers:n,status:200,data:{code:500,data:"",msg:"请求失败"}};return r.responseError&&(o[s]||Ke.indexOf(s)>-1)&&r.responseError(t,e),De(a,s,r,e)}))}))}(ze);var Ve,Je,Be={get(e,t={},s={}){let r=(/http/.test(e),`${e}?`);const o=i({},t);Object.keys(o).forEach((e=>{var t=o[e];r+=`${e}=${encodeURIComponent(t)}&`}));const n=i({method:"get",url:r,mode:"cors",withCredentials:!1,validateStatus:Me},s);return ze.request(n).then((e=>e.data),(e=>e))},post(e,t={},s={}){const r=/http/.test(e)?e:`${e}`,o=i({method:"post",url:r,mode:"cors",withCredentials:!1,validateStatus:Me,data:t},s);return ze.request(o).then((e=>e.data),(e=>Promise.reject(e)))}};(Je=Ve||(Ve={})).POST="post",Je.GET="get";const Fe={upload:{type:Ve.POST,url:"/upload_pdf_b64",errorToast:!0},pdf_detail:{type:Ve.GET,url:"/file/pdf/queryDetail",errorToast:!0},chunk2summary:{type:Ve.POST,url:"/chunk2summary"},getPdfInfo:{type:Ve.GET,url:"/get_pdf_info"}},Ge={};Object.keys(Fe).forEach((e=>{Ge[e]=(t,s={},r="")=>{const o=Fe[e],{type:n,url:a}=o,c=u(o,["type","url"]);return Be[n](a+r,t,i(i({},c),s))}}));var He=C({state:{isLogin:!1,accountInfo:null,userInfo:{},pdfInfo:{},pagesInfo:[],pageSize:[],summaryData:[],isShowProgress:!1,percent:0,fileName:"",avaterUrl:"",tokenInfo:{name:"",value:""},isSummaryInit:!1,intervalArr:[],feedbackList:[],pageOfChunk:[]},mutations:{setAccountInfo(e,t){e.accountInfo=t||null},setUserInfo(e,t){e.userInfo=t||{}},setPdfInfo(e,t){e.pdfInfo=t||{}},setPagesInfo(e,t){e.pagesInfo=t||[]},setPageSize(e,t){e.pageSize=t||[]},setSummaryData(e,t){e.summaryData=t||[]},setIsShowProgress(e,t){e.isShowProgress=t},setPercent(e,t){e.percent=t||0},setFileName(e,t){e.fileName=t||""},setIsLogin(e,t){e.isLogin=t},setAvaterUrl(e,t){e.avaterUrl=t},setTokenInfo(e,t){e.tokenInfo=t||{name:"",value:""}},setIsSummaryInit(e,t){e.isSummaryInit=t},setIntervalArr(e,t){e.intervalArr=t||[]},setFeedbackList(e,t){e.feedbackList=t||[]},setPageOfChunk(e,t){e.pageOfChunk=t||[]}},actions:{setAccountInfo({commit:e},t){e("setAccountInfo",t)},getUserInfo({commit:e}){console.log("zxxcommit--",e),Ge.getUserInfo().then((t=>{if(0===t.code){const{usedCapacity:s,allCapacity:r}=t.data,o=c(i({},t.data),{isCapacityOver:s>=r,isCapacityNearOver:s>=.95*r});e("setUserInfo",o)}}))}},modules:{}});const Qe={permission:{mounted(e,t){const{value:s}=t,{btnPermissions:r=[]}=t.instance.$route.meta;if(s&&s instanceof Array&&s.length>0){const t=s;r.some((e=>t.includes(e)))||e.parentNode&&e.parentNode.removeChild(e)}}}};window.structuredClone&&"function"==typeof window.structuredClone||(window.structuredClone=A);const We=T(Oe);function Xe(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]}We.use(He).use(Le),We.use($),We.use(U),We.use(K),We.use(D),We.use(z),We.use(M),We.use(V),We.use(J),We.use(B),We.use(F),We.use(G),We.use(H),We.use(Q),We.use(W),We.use(X),We.use(Y),We.use(Z),We.use(ee),We.use(te),We.use(se),We.use(re),We.use(oe),We.use(ne),We.use(ae),We.use(ie),We.use(ce),We.use(ue),q.config({top:"50%",duration:2,maxCount:3}),Object.keys(Qe).forEach((e=>{We.directive(e,Qe[e])})),We.mount("#app");const Ye=Reflect.getPrototypeOf(Int8Array);for(const Ze of[Array,String,Ye])Object.defineProperty(Ze.prototype,"at",{value:Xe,writable:!0,enumerable:!1,configurable:!0});export{he as E,ye as _,Ge as a,we as r,le as u};
